---
title: 代码整洁之道
date: 2024-04-13
cover: /reads/代码整洁之道.jpg
---

## 一、变量命名规则

1. **名副其实:** 表明该变量或func是干什么的
2. **避免误导:** 比如不用小写L和大写O，避免和数字 1 和 0 混淆
3. **有意义的区分:** person、thePerson、personInfo和personData词面上无区别，如果想区分要明确区分开
4. **使用能读得出来的名称:** 为了沟通方便
5. **使用可搜索的名称**: 为了好搜索
6. **避免使用编码**
    1. 匈牙利标记法: nameString、phoneNumber
    2. 前缀: my_name
7. **避免思维映射:** 不要让读者的思想还需要映射成你的思想，比如index就用index、idx、i，不要用其他的
8. **class用名词、func用动词**
9. **别装可爱:** 不要用俚语、谚语、歇后语等，要直意
10. **每个概念都用一个词:** 所有类的加都加add，不要有的叫add有的叫increase
11. **别用双关语:** 若有类实现类似增加但实际不是的时候，用insert、append，不要为了概念统一而用add
12. **使用解决方案领域名称:** 程序员就用程序员的词汇，比如jobQueses
13. **使用源自所涉问题领域的名称:** 不得行就用业务的词汇
14. **添加有意义的语境:** addPerson、appendPersonList
15. **不要添加无意义的语境:** 短名称能说明白就无需增加语境

## 二、函数

1. **短小**
2. **只做一件事情**
3. **每个函数一个抽象层级**
4. **switch语句**
5. **使用描述性的名称**
6. **参数越少越好**
7. **无副作用**: 函数内尽量少做无关的事情，解耦
8. **分隔指令与询问**: 函数要么作为指令，要么作为查询，不要既指令又查询
9. **使用异常代替返回错误码**: tryCatch
10. **别重复**: 各个函数不要存在重复代码
11. **结构化编程**
12. **如何写出这样的函数**: 初期就完善case，后期在跑通case情况下不断打磨优化

## 三、注释

1. **注释不能美化糟糕的代码**
2. **用代码来阐述**
3. **好注释**
    1. 给信息注释，例如函数的参数、返回值
    2. 对意图注释
    3. 阐释，例如switch的每个case后边写出情景
    4. 警示
    5. TODO
    6. jsDoc、javaDoc
4. **坏注释**
    1. 喃喃自语
    2. 多余的注释
    3. 误导性注释，初衷好，但是不如代码来的精确
    4. 循规式注释，不是所有变量方法都必须有注释
    5. 日志式注释，每个文件方法头部写编辑时间编辑人等无用信息
    6. 废话注释
    7. 能用函数或变量名称说明就不用注释
    8. 位置标记，注释一堆符号为了快速定位
    9. 注释掉的代码，后人不敢打开注释也不敢删除

## 四、格式

1. **垂直格式**
    1. **向报纸学习:** 标题 => 主体 => 细节
    2. **垂直方向的间隔:** 空白行隔断不同思路的代码
    3. **垂直方向的靠近:** 紧密相关的代码应该相互靠近
    4. **垂直顺序:** 被调用的函数应该放在调用者的下边
2. **水平格式**
    1. **水平方向的区隔与靠近:** 空格
    2. **缩进**
3. **团队规则**
   > “每个程序员都有自己喜欢的格式规则，但如果在一个团队中工作，就是团队说了算”

## 五、对象和数据结构

1. **数据抽象:** 需要的数据，本身的实现抽象出来
2. **数据、对象的反对称性**
    1. **面向过程:** 在不动现有数据结构上添加新函数，难以更改数据结构
    2. **面向对象:** 在不动现有函数上修改数据结构，难以添加新函数
3. 得墨忒耳率
   > “模块不应了解它所操作对象的内部情形”
4. 数据传送对象
   > “最为精练的数据结构，是一个只有公共变量、没有函数的类。”

## 六、错误处理

1. **使用异常而非返回码:** 直接throw error，而非用code去区分不同error
2. **先写try-catch-finally**
3. **使用不可控异常**
4. **给出异常发生的环境:** 抛错时，给出当前错误的环境及变量说明
5. **依调用者需要定义异常类:** 错误策略模式
6. **定义常规流程:** 不是所有的异常情况都需要捕获处理，跑通流程即可
7. **别返回或使用null值**

## 七、单元测试

1. **TDD三大定律**
    1. 在没写完`不通过的case`之前，不能写业务代码
    2. 只可编写`刚好无法通过的case`
    3. 只可编写`刚好通过错误case的业务代码`
2. **保持测试的整洁:** 随着业务代码的更新而更新测试代码
3. **可读性**
4. **F · I · R · S · T**
    - **`Fast`:** 快速
    - **`Independent`:** case独立
    - **`Repeatable`:** case可在任何环境重复通过
    - **`Self-Validating`**: case内自主验证
    - **`Timely`:** 及时编辑及修改
